{% load static %}
<!DOCTYPE html>
<html lang="pl" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Kancelaria ‚Äì logowanie{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  {# Bootstrap z lokalnego static #}
  <link
    href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}"
    rel="stylesheet"
  />

  {# Ikony (u≈ºywane np. w prze≈ÇƒÖczniku motywu, je≈õli chcesz) #}
  <link rel="stylesheet" href="{% static 'vendor/bootstrap-icons/bootstrap-icons.min.css' %}">

  {# Motyw jasny/ciemny #}
  <link rel="stylesheet" href="{% static 'css/theme.css' %}">

  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    main {
      flex: 1;
    }
    .auth-card {
      max-width: 420px;
      margin: 0 auto;
    }
  </style>
</head>
<body>

  {# Pasek na g√≥rze: tytu≈Ç + prze≈ÇƒÖcznik motywu #}
  <header class="border-bottom mb-4">
    <div class="container d-flex justify-content-between align-items-center py-2">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-church fs-4 text-muted"></i>
        <span class="fw-semibold text-muted">Kancelaria parafialna</span>
      </div>

      <button id="theme-toggle"
              class="btn btn-sm btn-outline-secondary"
              type="button"
              title="Prze≈ÇƒÖcz motyw">
        <i class="bi bi-moon-stars" id="theme-toggle-icon"></i>
      </button>
    </div>
  </header>

  <main class="container py-4 d-flex align-items-center justify-content-center">
    <div class="auth-card w-100">
      {% if messages %}
        {% for m in messages %}
          <div class="alert alert-{{ m.tags }} alert-dismissible fade show small shadow-sm border-0" role="alert">
            <i class="bi bi-info-circle-fill me-2"></i> {{ m }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      {# Tutaj wstrzykujesz w≈Ça≈õciwƒÖ tre≈õƒá (np. formularz logowania) #}
      {% block content %}{% endblock %}
    </div>
  </main>

  <footer class="border-top py-2">
    <div class="container text-center text-muted small">
      ¬© {% now "Y" %} Kancelaria parafialna
    </div>
  </footer>

  {# Skrypty #}
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

  <script>
  (function () {
    const STORAGE_KEY = "kp-theme";

    function applyTheme(theme) {
      const html = document.documentElement;
      const next = theme === "dark" ? "dark" : "light";
      html.setAttribute("data-theme", next);

      const icon = document.getElementById("theme-toggle-icon");
      if (icon) {
        // je≈õli u≈ºywasz Bootstrap Icons
        if (icon.classList.contains("bi")) {
          icon.classList.remove("bi-moon-stars", "bi-sun");
          icon.classList.add(next === "dark" ? "bi-sun" : "bi-moon-stars");
        } else {
          // fallback dla zwyk≈Çego <span> z emoji
          icon.textContent = next === "dark" ? "‚òÄÔ∏è" : "üåô";
        }
      }
    }

    // wyb√≥r startowy: z localStorage albo z ustawie≈Ñ systemu
    let saved = null;
    try {
      saved = localStorage.getItem(STORAGE_KEY);
    } catch (e) {
      saved = null;
    }

    const prefersDark =
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;

    const initial = saved || (prefersDark ? "dark" : "light");
    applyTheme(initial);

    const btn = document.getElementById("theme-toggle");
    if (!btn) return;

    btn.addEventListener("click", function () {
      const current = document.documentElement.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      applyTheme(next);
      try {
        localStorage.setItem(STORAGE_KEY, next);
      } catch (e) {
        // w trybie ‚Äûbrak pamiƒôci‚Äù po prostu ignorujemy
      }
    });
  })();
</script>
</body>
</html>
