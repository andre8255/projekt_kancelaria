{% extends "base_panel.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-start mb-3">
   
  <h1 class="h5 mb-0">Rodzina: {{ rodzina.nazwa }}</h1>

  

  <div class="ms-3 d-flex flex-wrap gap-2">
    <a href="{% url 'rodzina_pdf' rodzina.pk %}" target="_blank" class="btn btn-outline-secondary btn-sm">
      üìÑ Pobierz Kartotekƒô Rodziny (PDF)
    </a>
<!--
    <a href="{% url 'rodzina_druk' rodzina.pk %}" target="_blank" class="btn btn-outline-secondary btn-sm">
      üñ®Ô∏è Drukuj kartotekƒô
    </a>
-->

    <a href="{% url 'rodzina_edytuj' rodzina.pk %}" class="btn btn-outline-secondary btn-sm">
     ‚úèÔ∏è Edytuj
    </a>

    <a href="{% url 'rodzina_usun' rodzina.pk %}" class="btn btn-outline-danger btn-sm">
     üóëÔ∏è Usu≈Ñ
    </a>

    <a href="{% url 'rodzina_lista' %}" class="btn btn-outline-secondary btn-sm">
     ‚¨Ö Powr√≥t
    </a>
  </div>
</div>

<div class="row g-4">

  <!-- Adres -->
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header fw-semibold">Adres</div>
      <div class="card-body small">
        <p class="mb-1">
          {{ rodzina.ulica }} {{ rodzina.nr_domu }}{% if rodzina.nr_mieszkania %}/{{ rodzina.nr_mieszkania }}{% endif %}
        </p>
        <p class="mb-1">
          {{ rodzina.kod_pocztowy }} {{ rodzina.miejscowosc }}
        </p>
        <p class="mb-0 text-muted small">
          Poczta: {{ rodzina.poczta }}
        </p>
      </div>
    </div>
  </div>

  <!-- Kontakt -->
  <div class="col-md-6">
    <div class="card shadow-sm h-100">
      <div class="card-header fw-semibold">Kontakt</div>
      <div class="card-body small">
        {% if rodzina.telefon_kontaktowy %}
          <p class="mb-1">Telefon: {{ rodzina.telefon_kontaktowy }}</p>
        {% endif %}

        {% if rodzina.email_kontaktowy %}
          <p class="mb-1">Email: {{ rodzina.email_kontaktowy }}</p>
        {% endif %}

        {% if rodzina.uwagi %}
          <p class="mb-0">
            <strong>Uwagi:</strong><br>
            <span class="text-muted" style="white-space: pre-line;">
              {{ rodzina.uwagi }}
            </span>
          </p>
        {% endif %}









        {% if not rodzina.telefon_kontaktowy and not rodzina.email_kontaktowy and not rodzina.uwagi %}
          <p class="mb-0 text-muted small">Brak danych kontaktowych.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Cz≈Çonkowie rodziny -->
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
        <span class="fw-semibold">Cz≈Çonkowie rodziny</span>

        <div class="d-flex flex-wrap gap-2">
          <a href="{% url 'rodzina_dodaj_czlonka' rodzina.pk %}"
             class="btn btn-primary btn-sm">
            + Dodaj cz≈Çonka
          </a>

          <a href="{% url 'rodzina_lista' %}" class="btn btn-outline-secondary btn-sm">
           ‚¨Ö Powr√≥t
          </a>
        </div>
      </div>

      <div class="card-body p-0">

        {% if czlonkowie_posortowani %}
          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th scope="col">Rola</th>
                  <th scope="col">Osoba</th>
                  <th scope="col">Status zamieszkania</th>
                  <th scope="col">Sakramenty</th>
                  <th class="text-end">Akcje</th>
                </tr>
              </thead>
              <tbody>

                {% for w in czlonkowie_posortowani %}
                  <tr>

                    <!-- Rola -->
                    <td>
                      {% if w.rola_display %}
                        <span class="badge text-bg-light border">
                          {{ w.rola_display }}
                        </span>
                      {% else %}
                        <span class="text-muted">‚Äî</span>
                      {% endif %}
                    </td>

                    <!-- Osoba -->
                    <td>
                      <div class="fw-semibold">
                        {{ w.osoba.nazwisko }} {{ w.osoba.imie_pierwsze }}
                      </div>
                      <div class="text-muted small">
                        {% if w.osoba.data_urodzenia %}
                          ur. {{ w.osoba.data_urodzenia }}
                        {% endif %}
                      </div>
                    </td>

                    <!-- Status zamieszkania -->
                    <td>
                      {% if w.status_display %}
                        <span class="badge text-bg-light border">
                          {{ w.status_display }}
                        </span>
                      {% else %}
                        <span class="text-muted small">‚Äî</span>
                      {% endif %}
                    </td>

                    <!-- Sakramenty -->
                    <td class="small text-muted">

                      <div>
                        Chrzest:
                        {% if w.sakramenty.chrzest %}
                          <span class="text-success fw-semibold">tak</span>
                        {% else %}
                          <span class="text-danger">nie</span>
                        {% endif %}
                      </div>

                      <div>
                        Komunia:
                        {% if w.sakramenty.komunia %}
                          <span class="text-success fw-semibold">tak</span>
                        {% else %}
                          <span class="text-danger">nie</span>
                        {% endif %}
                      </div>

                      <div>
                        Bierzmowanie:
                        {% if w.sakramenty.bierzmowanie %}
                          <span class="text-success fw-semibold">tak</span>
                        {% else %}
                          <span class="text-danger">nie</span>
                        {% endif %}
                      </div>

                      <div>
                        Ma≈Ç≈ºe≈Ñstwo:
                        {% if w.sakramenty.malzenstwo %}
                          <span class="text-success fw-semibold">tak</span>
                        {% else %}
                          <span class="text-danger">nie</span>
                        {% endif %}
                      </div>

                      <div>
                        Namaszczenie:
                        {% if w.sakramenty.namaszczenie %}
                          <span class="text-success fw-semibold">tak</span>
                        {% else %}
                          <span class="text-danger">nie</span>
                        {% endif %}
                      </div>

                      <div>
                        Zgon:
                        {% if w.sakramenty.zgon %}
                          <span class="text-success fw-semibold">tak</span>
                        {% else %}
                          <span class="text-danger">nie</span>
                        {% endif %}
                      </div>

                    </td>

                    <!-- Akcje -->
                    <td class="text-end">
                      <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'osoba_szczegoly' w.osoba.pk %}"
                           class="btn btn-outline-secondary">
                          <i class="bi bi-eye"></i> Szczeg√≥≈Çy osoby
                        </a>

                        <a href="{% url 'rodzina_czlonek_usun' w.relacja.pk %}"
                           class="btn btn-outline-danger">
                         <i class="bi bi-trash"></i> Usu≈Ñ z rodziny
                        </a>
                      </div>
                    </td>

                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

        {% else %}
          <div class="p-3 text-muted small">
            Brak przypisanych cz≈Çonk√≥w.
          </div>
        {% endif %}

      </div>
    </div>
  </div>

<hr class="my-4">

    <div class="d-flex justify-content-between align-items-center mb-2">
      <h2 class="h6 fw-bold mb-0">Historia wizyt duszpasterskich (Kolƒôda)</h2>
      <a href="{% url 'wizyta_nowa' rodzina.pk %}" class="btn btn-sm btn-outline-primary">
        + Dodaj wizytƒô
      </a>
    </div>

    <div class="card shadow-sm">
      <div class="card-body p-0">
        {% if rodzina.wizyty.exists %}
          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Rok</th>
                  <th>Data</th>
                  <th>Status</th>
                  <th>KsiƒÖdz</th>
                  <th>Notatka</th>
                  <th class="text-end">Akcje</th>
                </tr>
              </thead>
              <tbody>
                {% for w in rodzina.wizyty.all %}
                <tr class="{% if w.status == 'ODMOWA' %}table-danger{% elif w.status == 'NIEOBECNI' %}table-warning{% endif %}">
                  <td class="fw-bold">{{ w.rok }}</td>
                  <td>{{ w.data_wizyty|default:"‚Äî" }}</td>
                  <td>
                    {% if w.status == 'PRZYJETA' %}
                      <span class="badge text-bg-success">Przyjƒôta</span>
                    {% elif w.status == 'NIEOBECNI' %}
                      <span class="badge text-bg-warning">Nieobecni</span>
                    {% elif w.status == 'ODMOWA' %}
                      <span class="badge text-bg-danger">Odmowa</span>
                    {% else %}
                      {{ w.get_status_display }}
                    {% endif %}
                  </td>
                  <td>{{ w.ksiadz|default:"‚Äî" }}</td>
                  <td class="text-muted fst-italic text-truncate" style="max-width: 200px;">
                    {{ w.notatka }}
                  </td>
                  <td class="text-end">
                    <a href="{% url 'wizyta_edytuj' w.pk %}" class="btn btn-link btn-sm p-0 text-secondary" title="Edytuj">
                      ‚úèÔ∏è
                    </a>
                    <a href="{% url 'wizyta_usun' w.pk %}" class="btn btn-link btn-sm p-0 text-danger ms-2" title="Usu≈Ñ">
                      üóëÔ∏è
                    </a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="p-3 text-muted small text-center">
            Brak odnotowanych wizyt. Kliknij "Dodaj wizytƒô", aby rozpoczƒÖƒá historiƒô.
          </div>
        {% endif %}
      </div>
    </div>





</div>

{% endblock %}
