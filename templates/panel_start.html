<!--templates/panel_start.html-->

{% extends "base_panel.html" %}
{% block content %}

<style>
  .mini-cal { --gap: .5rem; }
  .mini-cal .week { display: grid; grid-template-columns: repeat(7, 1fr); gap: var(--gap); }
  .mini-cal .day {
    position: relative; padding: .5rem .4rem; border-radius: .75rem;
    background: #fff; border: 1px solid #eef1f4; min-height: 72px;
    transition: transform .08s ease, box-shadow .08s ease;
  }
  .mini-cal .day:hover { transform: translateY(-1px); box-shadow: 0 4px 18px rgba(0,0,0,.06); }
  .mini-cal .dm-muted { opacity: .5; }
  .mini-cal .dow { font-size: .72rem; letter-spacing: .02em; color: #6c757d; }
  .mini-cal .num { font-weight: 600; }
  .mini-cal .today {
    outline: 2px solid #0d6efd22; box-shadow: inset 0 0 0 1.5px #0d6efd33;
    background: linear-gradient(180deg, #f8fbff, #ffffff);
  }
  .mini-cal .chips { display: flex; gap: .25rem; flex-wrap: wrap; margin-top: .35rem; }
  .chip { font-size: .68rem; padding: .1rem .38rem; border-radius: 999px; border: 1px solid transparent; }
  .chip-all { color: #495057; background: #f1f3f5; border-color: #e9ecef; }
  .chip-busy { color: #842029; background: #f8d7da; border-color: #f1aeb5; }
  .mini-cal .dot {
    width: .45rem; height: .45rem; border-radius: 50%; display: inline-block; vertical-align: middle;
  }
  .dot-free { background:#198754; } .dot-busy { background:#dc3545; }
  .legend { gap: .5rem; }
  .mini-cal a { text-decoration: none; color: inherit; }
</style>




<!--
{# KAFELKI #}
<div class="row g-3 mb-4">
  <div class="col-sm-6 col-lg-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-muted small">Osoby</div>
        <div class="h4 mb-0">{{ stats.osoby }}</div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-muted small">Rodziny</div>
        <div class="h4 mb-0">{{ stats.rodziny }}</div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-2">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-muted small">Chrzty</div>
        <div class="h4 mb-0">{{ stats.chrzty }}</div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-2">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-muted small">Bierzm.</div>
        <div class="h4 mb-0">{{ stats.bierzmowania }}</div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-2">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-muted small">Śluby</div>
        <div class="h4 mb-0">{{ stats.sluby }}</div>
      </div>
    </div>
  </div>
</div>

{# SZYBKIE AKCJE #}
<div class="card shadow-sm border-0 mb-4">
  <div class="card-body d-flex flex-wrap gap-2">
    <a href="{% url 'osoba_nowa' %}" class="btn btn-primary btn-sm">+ Nowa osoba</a>
    <a href="{% url 'chrzest_dodaj' %}" class="btn btn-outline-primary btn-sm">+ Nowy chrzest</a>
    <a href="{% url 'malzenstwo_dodaj' %}" class="btn btn-outline-primary btn-sm">+ Nowe małżeństwo</a>
    <a href="{% url 'msza_nowa' %}" class="btn btn-outline-primary btn-sm">+ Nowa msza</a>
  </div>
</div>
-->

{# MINI KALENDARZ #}
<div class="card shadow-sm border-0 mb-4">
  <div class="card-header bg-white d-flex justify-content-between align-items-center">
    <div class="fw-semibold">Kalendarz mszy – {{ mini_kalendarz.month_label }}</div>
    <div class="legend d-none d-sm-flex align-items-center">
      <span class="dot dot-free me-1"></span><span class="text-muted small me-3">wolna</span>
      <span class="dot dot-busy me-1"></span><span class="text-muted small">zajęta</span>
    </div>
  </div>

  <div class="card-body">
    <div class="mini-cal">
      {# Nagłówki dni (pn–nd) #}
      <div class="week mb-2">
      {% for dow in dni_tyg %}
    <div class="text-center dow">{{ dow }}</div>
     {% endfor %}
      </div>


      {# Tygodnie #}
      {% for week in mini_kalendarz.weeks %}
        <div class="week mb-2">
          {% for day in week %}
            {# link do listy mszy z filtrem daty #}
            <a class="day {% if day.is_other_month %}dm-muted{% endif %} {% if day.is_today %}today{% endif %}"
               href="{% url 'msza_lista' %}?data={{ day.date|date:'Y-m-d' }}"
               title="{% if day.all %}Msze: {{ day.all }}, zajęte: {{ day.busy }}{% else %}Brak mszy{% endif %}">
              <div class="d-flex justify-content-between align-items-start">
                <span class="num">{{ day.date.day }}</span>
                {% if day.busy %}
                  <span class="dot dot-busy" aria-hidden="true"></span>
                {% elif day.all %}
                  <span class="dot dot-free" aria-hidden="true"></span>
                {% endif %}
              </div>

              {% if day.all %}
                <div class="chips">
                  <span class="chip chip-all">{{ day.all }} msz.</span>
                  {% if day.busy %}<span class="chip chip-busy">{{ day.busy }} zaj.</span>{% endif %}
                </div>
              {% else %}
                <div class="text-muted" style="font-size:.72rem; margin-top:.35rem;">—</div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      {% endfor %}
    </div>

    <div class="d-sm-none mt-2">
      <span class="dot dot-free me-1"></span><span class="text-muted small me-3">wolna</span>
      <span class="dot dot-busy me-1"></span><span class="text-muted small">zajęta</span>
    </div>
  </div>
</div>



<div class="row g-4">
  {# Najbliższe msze #}
  <div class="col-lg-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-white fw-semibold">Najbliższe msze</div>
      <div class="card-body small">
        {% if msze_najblizsze %}
          <ul class="list-group list-group-flush">
            {% for m in msze_najblizsze %}
              <li class="list-group-item d-flex justify-content-between">
                <span>
                  {{ m.data }} {{ m.godzina }} — {{ m.miejsce|default:"—" }}
                  {% if m.intencje.exists %}<span class="badge bg-danger-subtle text-danger ms-1">zajęta</span>
                  {% else %}<span class="badge bg-success-subtle text-success ms-1">wolna</span>{% endif %}
                </span>
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'msza_szczegoly' m.pk %}">Szczegóły</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted">Brak zaplanowanych mszy.</div>
        {% endif %}
      </div>
    </div>
  </div>

  {# Ostatnie wpisy #}
  <div class="col-lg-6">
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-header bg-white fw-semibold">Ostatnie chrzty</div>
      <div class="card-body small">
        {% if ostatnie_chrzty %}
          <ul class="list-group list-group-flush">
            {% for c in ostatnie_chrzty %}
              <li class="list-group-item d-flex justify-content-between">
                <span>{{ c.rok }}/{{ c.akt_nr }} — {{ c.ochrzczony }}</span>
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'chrzest_szczegoly' c.pk %}">Pokaż</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted">Brak wpisów.</div>
        {% endif %}
      </div>
    </div>

    <div class="card shadow-sm border-0">
      <div class="card-header bg-white fw-semibold">Ostatnie małżeństwa</div>
      <div class="card-body small">
        {% if ostatnie_sluby %}
          <ul class="list-group list-group-flush">
            {% for s in ostatnie_sluby %}
              <li class="list-group-item d-flex justify-content-between">
                <span>{{ s.rok }}/{{ s.akt_nr|default:"—" }} — {{ s.malzonek_a }} &amp; {{ s.malzonek_b }}</span>
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'malzenstwo_szczegoly' s.pk %}">Pokaż</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="text-muted">Brak wpisów.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
