{% extends "base_print.html" %}
{% block title %}Wykaz Mszy{% endblock %}

{% block content %}
<style>
  @page {
    size: A4 landscape; /* Lista jest szeroka, lepiej wygląda poziomo */
    margin: 15mm;
  }
  .doc {
    max-width: 100%;
    margin: 0 auto;
    color: #000;
    font-family: "Times New Roman", serif;
    font-size: 10pt;
  }
  h1 {
    text-align: center;
    margin-bottom: 1cm;
    color: #063267;
    font-weight: 700;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #999;
    padding: 6px 8px;
    text-align: left;
    vertical-align: top;
  }
  th {
    background: #f4f4f4;
    color: #000;
    font-weight: 700;
  }
  tbody tr:nth-child(even) {
    background: #fdfdfd;
  }
  /* Styl dla listy intencji wewnątrz komórki tabeli */
  ul.intencje-list {
    margin: 0;
    padding-left: 15px;
    list-style-type: disc;
  }
  ul.intencje-list li {
    margin-bottom: 2px;
  }
  .zamawiajacy {
    font-style: italic;
    color: #444;
    font-size: 0.9em;
  }
</style>

<div class="doc">
  <h1>Wykaz Mszy</h1>

  {% if request.GET.data or request.GET.status or request.GET.q %}
    <p style="text-align: center; font-style: italic; font-size: 9pt;">
      Lista filtrowana.
      {% if request.GET.data %} Data: {{ request.GET.data }}.{% endif %}
      {% if request.GET.status %} Status: {{ request.GET.status }}.{% endif %}
      {% if request.GET.q %} Fraza: "{{ request.GET.q }}".{% endif %}
    </p>
  {% endif %}

  {% if msze %}
    <table>
      <thead>
        <tr>
          <th style="width: 30px;">Lp.</th>
          <th style="width: 80px;">Data</th>
          <th style="width: 50px;">Godz.</th>     
          <th>Intencje</th>
          <th>Miejsce / Celebrans</th>
        </tr>
      </thead>
      <tbody>
        {% for msza in msze %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ msza.data|date:"d.m.Y" }}</td>
          <td>{{ msza.godzina|time:"H:i" }}</td>
          
          <td>
            {% with intencje=msza.intencje.all %}
              {% if intencje %}
                <ul class="intencje-list">
                  {% for i in intencje %}
                    <li>
                      {{ i.tresc }}
                      {% if i.zamawiajacy %}
                        <span class="zamawiajacy">({{ i.zamawiajacy }})</span>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <span style="color: #006400; font-style: italic;">Wolna</span>
              {% endif %}
            {% endwith %}
          </td>



          <td>
            {{ msza.miejsce|default:"—" }}
            {% if msza.celebrans %}
              <br><span style="font-size: 0.9em; color: #555;"> {{ msza.celebrans }}</span>
            {% endif %}
          </td>

          
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p style="text-align: center;">Brak mszy pasujących do filtrów.</p>
  {% endif %}
</div>
{% endblock %}