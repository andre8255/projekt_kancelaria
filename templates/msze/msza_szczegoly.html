{% extends "base_panel.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-start flex-wrap gap-3 mb-4">
  <div>
    <h1 class="h4 mb-1 fw-semibold d-flex align-items-center gap-2">
      Msza: {{ msza.data }} godz. {{ msza.godzina }}
      
      {# Efekt WOW: Kolorowa plakietka z typem mszy #}
      <span class="badge rounded-pill text-bg-light border fw-normal fs-6">
        {{ msza.get_typ_display }}
      </span>
    </h1>
    <div class="text-muted small">
      {{ msza.miejsce }}{% if msza.celebrans %}, celebrans: {{ msza.celebrans }}{% endif %}
    </div>
  </div>

  <div class="d-flex flex-wrap gap-2">
    <a href="{% url 'msza_edytuj' msza.pk %}" class="btn btn-outline-secondary btn-sm">
      ✏️ Edytuj mszę
    </a>
    <a href="{% url 'intencja_nowa' msza.pk %}" class="btn btn-primary btn-sm">
      + Dodaj intencję
    </a>
    <a href="{% url 'msza_lista' %}" class="btn btn-outline-secondary btn-sm">
      ⬅ Powrót
    </a>
  </div>
</div>

<div class="row g-4">
  <div class="col-md-5">
    <div class="card shadow-sm border-0">
      <div class="card-header fw-semibold">
        Informacje o mszy
      </div>
      <div class="card-body small">
        <p><strong>Data:</strong> {{ msza.data }}</p>
        <p><strong>Godzina:</strong> {{ msza.godzina }}</p>
        <p><strong>Rodzaj:</strong> {{ msza.get_typ_display }}</p>
        <p><strong>Miejsce:</strong> {{ msza.miejsce }}</p>
        
        {% if msza.celebrans %}
          <p><strong>Celebrans:</strong> {{ msza.celebrans }}</p>
        {% elif msza.celebrans_opis %}
          <p><strong>Celebrans:</strong> {{ msza.celebrans_opis }}</p>
        {% endif %}

        {% if msza.uwagi %}
          <p><strong>Uwagi:</strong><br>{{ msza.uwagi|linebreaksbr }}</p>
        {% endif %}
        
        <hr>
        
        <p><strong>Liczba intencji:</strong> {{ msza.intencje.count }}</p>
        {% if msza.intencje.count == 0 %}
          <p class="text-success fw-semibold mb-0">Ten termin jest wolny.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-7">
    <div class="card shadow-sm border-0">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-semibold">Intencje mszalne</span>
      </div>
      <div class="card-body p-0">
        <table class="table table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Treść intencji</th>
              <th>Zamawiający</th>
              <th>Status opłaty</th>
              <th class="text-end">Akcje</th> 
            </tr>
          </thead>
          <tbody>
            {% for i in intencje %}
              <tr>
                <td class="small">
                  {{ i.tresc|linebreaksbr }}
                  {% if i.uwagi %}
                    <div class="text-muted fst-italic small">
                      Uwagi: {{ i.uwagi }}
                    </div>
                  {% endif %}
                </td>
                <td class="small">{{ i.zamawiajacy }}</td>
                <td class="small">
                  {% if i.status_oplaty == "OPLACONA" %}
                    <span class="badge bg-success-subtle text-success border border-success">
                      {{ i.get_status_oplaty_display }}
                    </span>
                  {% else %}
                    <span class="badge bg-danger-subtle text-danger border border-danger">
                      {{ i.get_status_oplaty_display }}
                    </span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <a href="{% url 'intencja_edytuj' i.pk %}" class="btn btn-outline-secondary btn-sm me-1">
                    <i class="bi bi-pencil"></i> Edytuj
                  </a>
                  <a href="{% url 'intencja_usun' i.pk %}" class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-trash"></i> Usuń
                  </a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="text-muted p-3 small text-center">
                  Brak intencji. Termin wolny.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
