{% extends "base_panel.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-start flex-wrap gap-3 mb-4">
  <h1 class="h5 mb-0">Chrzest</h1>

  <div class="d-flex flex-wrap gap-2">
    {# Przycisk bezpo≈õredni (opcjonalnie, bo mamy panel ni≈ºej) #}
    <a href="{% url 'chrzest_pdf' chrzest.pk %}" target="_blank" class="btn btn-outline-secondary btn-sm">
      üìÑ PDF (Domy≈õlny)
    </a>

    <a href="{% url 'chrzest_edytuj' chrzest.pk %}" class="btn btn-outline-secondary btn-sm">
      Edytuj
    </a>
    <a href="{% url 'chrzest_usun' chrzest.pk %}" class="btn btn-outline-danger btn-sm">
      Usu≈Ñ
    </a>
    <a href="{% url 'chrzest_lista' %}" class="btn btn-outline-secondary btn-sm">
      Powr√≥t
    </a>
  </div>
</div>

<div class="row g-4">

  <div class="col-md-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header fw-semibold">Dane aktu chrztu</div>
      <div class="card-body small">
        <p class="mb-2">
          <span class="text-muted d-block">Rok / nr aktu</span>
          <strong>{{ chrzest.rok }}/{{ chrzest.akt_nr }}</strong>
        </p>
        <p class="mb-2">
          <span class="text-muted d-block">Data chrztu</span>
          {% if chrzest.data_chrztu %}
            <strong>{{ chrzest.data_chrztu }}</strong>
          {% elif chrzest.rok_chrztu %}
            <strong>rok {{ chrzest.rok_chrztu }}</strong>
          {% else %}
            <span class="text-muted">‚Äî</span>
          {% endif %}
        </p>
        <p class="mb-2">
          <span class="text-muted d-block">Miejsce chrztu</span>
          {% if chrzest.miejsce_chrztu %}
            <strong>{{ chrzest.miejsce_chrztu }}</strong>
          {% else %}
            <span class="text-muted">‚Äî</span>
          {% endif %}
        </p>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header fw-semibold">Ochrzczony / ochrzczona</div>
      <div class="card-body small">
        <p class="mb-2">
          <span class="text-muted d-block">Imiƒô i nazwisko</span>
          <strong>{{ chrzest.ochrzczony.nazwisko }} {{ chrzest.ochrzczony.imie_pierwsze }}</strong>
        </p>
        <p class="mb-2">
          <span class="text-muted d-block">Data urodzenia</span>
          {% if chrzest.data_urodzenia %}
            <strong>{{ chrzest.data_urodzenia }}</strong>
          {% elif chrzest.rok_urodzenia %}
            <strong>rok {{ chrzest.rok_urodzenia }}</strong>
          {% else %}
            <span class="text-muted">‚Äî</span>
          {% endif %}
        </p>
        <p class="mb-2">
          <span class="text-muted d-block">Miejsce urodzenia</span>
          {% if chrzest.miejsce_urodzenia %}
            <strong>{{ chrzest.miejsce_urodzenia }}</strong>
          {% else %}
            <span class="text-muted">‚Äî</span>
          {% endif %}
        </p>
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="card shadow-sm border-0">
      <div class="card-header fw-semibold">Rodzice</div>
      <div class="card-body small row g-4">
        <div class="col-md-6">
          <div class="border rounded p-3 h-100">
            <div class="text-muted small fw-semibold text-uppercase mb-2">Ojciec</div>
            <p class="mb-2">
              <span class="text-muted d-block">Imiƒô i nazwisko</span>
              <strong>{{ chrzest.ojciec|default:"‚Äî" }}</strong>
            </p>
            <p class="mb-0">
              <span class="text-muted d-block">Wyznanie</span>
              <strong>{{ chrzest.ojciec_wyznanie|default:"‚Äî" }}</strong>
            </p>
          </div>
        </div>
        <div class="col-md-6">
          <div class="border rounded p-3 h-100">
            <div class="text-muted small fw-semibold text-uppercase mb-2">Matka</div>
            <p class="mb-2">
              <span class="text-muted d-block">Imiƒô i nazwisko</span>
              <strong>{{ chrzest.matka|default:"‚Äî" }}</strong>
            </p>
            <p class="mb-2">
              <span class="text-muted d-block">Nazwisko rodowe</span>
              <strong>{{ chrzest.nazwisko_matki_rodowe|default:"‚Äî" }}</strong>
            </p>
            <p class="mb-0">
              <span class="text-muted d-block">Wyznanie</span>
              <strong>{{ chrzest.matka_wyznanie|default:"‚Äî" }}</strong>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="card shadow-sm border-0">
      <div class="card-header fw-semibold">Uwagi kancelaryjne</div>
      <div class="card-body small">
        {% if chrzest.uwagi_wew %}
          <p class="mb-0" style="white-space:pre-line;">{{ chrzest.uwagi_wew }}</p>
        {% else %}
          <p class="text-muted mb-0">Brak uwag.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="card shadow-sm border-0">
      <div class="card-header fw-semibold">Za≈ÇƒÖczniki</div>
      <div class="card-body small">
        {% if chrzest.skan_aktu %}
          <a href="{{ chrzest.skan_aktu.url }}" target="_blank" class="btn btn-outline-primary btn-sm">
            üìÑ Zobacz skan aktu
          </a>
        {% else %}
          <span class="text-muted">Brak za≈ÇƒÖczonego skanu.</span>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="card shadow-sm border-0 bg-light">
      <div class="card-header fw-semibold">
        üñ®Ô∏è Drukuj ≈õwiadectwo
      </div>
      <div class="card-body">
        <p class="card-text small text-muted">
          Wybierz adnotacjƒô, kt√≥ra ma siƒô pojawiƒá na wydruku w polu "Cel wydania / Uwagi".
        </p>

        <div class="d-flex gap-2 align-items-center flex-wrap">
          <div style="flex-grow: 1; max-width: 350px;">
            <label for="print_purpose" class="form-label small visually-hidden">Cel wydruku:</label>
            <select id="print_purpose" class="form-select form-select-sm">
              <option value="" selected>(Brak adnotacji - cel og√≥lny)</option>
              <option value="Do ≈õlubu ko≈õcielnego">Do ≈õlubu ko≈õcielnego</option>
              <option value="Do bierzmowania">Do bierzmowania</option>
              <option value="≈öwiƒôcenia kap≈Ça≈Ñskie">≈öwiƒôcenia kap≈Ça≈Ñskie</option>
              <option value="WystƒÖpienie z ko≈õcio≈Ça">WystƒÖpienie z ko≈õcio≈Ça</option>
              <option value="uwagi_wew">(Poka≈º uwagi wewnƒôtrzne z ksiƒôgi)</option>
            </select>
          </div>

          <button id="print_button" class="btn btn-primary btn-sm">
            Generuj PDF
          </button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  document.getElementById('print_button').addEventListener('click', function() {
    // 1. Pobierz wybranƒÖ warto≈õƒá z listy
    var cel = document.getElementById('print_purpose').value;

    // 2. Ustal bazowy adres URL do NOWEGO widoku PDF
    var baseUrl = "{% url 'chrzest_pdf' chrzest.pk %}";
    var finalUrl = baseUrl;

    // 3. Dodaj warto≈õƒá jako parametr URL
    if (cel) {
      // Je≈õli URL ma ju≈º parametry (rzadko w Django URLach, ale bezpieczniej sprawdziƒá)
      var separator = finalUrl.includes('?') ? '&' : '?';
      finalUrl += separator + 'cel=' + encodeURIComponent(cel);
    }
    
    // 4. Otw√≥rz stronƒô wydruku w nowej karcie
    window.open(finalUrl, '_blank');
  });
</script>

{% endblock %}