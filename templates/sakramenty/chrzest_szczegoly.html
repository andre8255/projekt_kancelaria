{% extends "base_panel.html" %}

{% block content %}

<div class="d-flex justify-content-between align-items-start mb-3">
  <div>
    <h1 class="h5 mb-1">Chrzest</h1>
  <div class="text-muted small">Szczeg√≥≈Çy przyjƒôcia sakramentu</div>
  </div>

  <div class="d-flex flex-wrap gap-2 ms-auto">
    <a href="{% url 'chrzest_pdf' chrzest.pk %}" target="_blank" class="btn btn-outline-secondary btn-sm">
      üìÑ Pobierz PDF (≈öwiadectwo)
    </a>
     <a href="{% url 'chrzest_druk' chrzest.pk %}" class="btn btn-outline-secondary btn-sm">
      üñ®Ô∏èDrukuj</a>
    <a href="{% url 'chrzest_edytuj' chrzest.pk %}" class="btn btn-outline-secondary btn-sm">‚úèÔ∏è Edytuj</a>
    <a href="{% url 'chrzest_usun' chrzest.pk %}" class="btn btn-outline-danger btn-sm">üóëÔ∏è Usu≈Ñ</a>
    <a href="{% url 'chrzest_lista' %}" class="btn btn-outline-secondary btn-sm">‚¨Ö Powr√≥t</a>
  </div>
</div>

<div class="row g-4">

  {# --- PIERWSZY WIERSZ: Dane aktu + Dane osoby --- #}
  <div class="col-md-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-light fw-semibold border-bottom">
        Dane aktu chrztu
      </div>
      <div class="card-body small">
        <div class="row mb-2">
          <div class="col-4 text-muted">Rok / Nr aktu:</div>
          <div class="col-8 fw-bold">{{ chrzest.rok }}/{{ chrzest.akt_nr }}</div>
        </div>
        <div class="row mb-2">
          <div class="col-4 text-muted">Data chrztu:</div>
          <div class="col-8">
            {% if chrzest.data_chrztu %}
              <strong>{{ chrzest.data_chrztu }}</strong>
            {% elif chrzest.rok_chrztu %}
              rok {{ chrzest.rok_chrztu }}
            {% else %}
              ‚Äî
            {% endif %}
          </div>
        </div>
        <div class="row mb-2">
          <div class="col-4 text-muted">Miejsce:</div>
          <div class="col-8">
            {% if chrzest.miejsce_chrztu %}
               {{ chrzest.miejsce_chrztu }}
            {% elif chrzest.parafia %}
               {{ chrzest.parafia }}
            {% else %}
               ‚Äî
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-success-subtle text-success-emphasis fw-semibold border-success-subtle">
        Ochrzczony / Ochrzczona
      </div>
      <div class="card-body small">
        <h5 class="card-title mb-3">
          {{ chrzest.ochrzczony.imie_pierwsze }} {{ chrzest.ochrzczony.nazwisko }}
        </h5>
        
        <div class="row mb-2">
          <div class="col-4 text-muted">Data urodzenia:</div>
          <div class="col-8">
            {% if chrzest.data_urodzenia %}
               {{ chrzest.data_urodzenia }}
            {% else %}
               {{ chrzest.ochrzczony.data_urodzenia|default:"‚Äî" }}
            {% endif %}
          </div>
        </div>
        
        <div class="row mb-2">
          <div class="col-4 text-muted">Miejsce ur.:</div>
          <div class="col-8">
            {% if chrzest.miejsce_urodzenia %}
               {{ chrzest.miejsce_urodzenia }}
            {% else %}
               {{ chrzest.ochrzczony.miejsce_urodzenia|default:"‚Äî" }}
            {% endif %}
          </div>
        </div>
        <div class="mt-3">
           <a href="{% url 'osoba_szczegoly' chrzest.ochrzczony.pk %}" class="btn btn-sm btn-outline-success">
             Przejd≈∫ do profilu osoby ‚ûû
           </a>
        </div>
      </div>
    </div>
  </div>

  {# --- DRUGI WIERSZ: Rodzice --- #}
  <div class="col-md-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-primary-subtle text-primary-emphasis fw-semibold border-primary-subtle">
        Ojciec
      </div>
      <div class="card-body small">
        <p class="mb-1">
          <span class="text-muted d-block">Imiƒô i nazwisko</span>
          <strong class="fs-6">{{ chrzest.ojciec|default:"‚Äî" }}</strong>
        </p>
        <hr class="my-2">
        <p class="mb-0">
          <span class="text-muted">Wyznanie:</span> 
          {{ chrzest.ojciec_wyznanie|default:"‚Äî" }}
        </p>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-danger-subtle text-danger-emphasis fw-semibold border-danger-subtle">
        Matka
      </div>
      <div class="card-body small">
        <p class="mb-1">
          <span class="text-muted d-block">Imiƒô i nazwisko</span>
          <strong class="fs-6">{{ chrzest.matka|default:"‚Äî" }}</strong>
        </p>
        <p class="mb-1">
          <span class="text-muted d-block">Nazwisko rodowe</span>
          {{ chrzest.nazwisko_matki_rodowe|default:"‚Äî" }}
        </p>
        <hr class="my-2">
        <p class="mb-0">
          <span class="text-muted">Wyznanie:</span> 
          {{ chrzest.matka_wyznanie|default:"‚Äî" }}
        </p>
      </div>
    </div>
  </div>

  {# --- TRZECI WIERSZ: Uwagi i Za≈ÇƒÖczniki --- #}
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        
        <h6 class="fw-bold text-muted text-uppercase small mb-3">Dodatkowe informacje</h6>
        
        <div class="mb-3 p-3 bg-light rounded border">
            <strong>Uwagi kancelaryjne:</strong><br>
            {% if chrzest.uwagi_wew %}
              <span style="white-space:pre-line;">{{ chrzest.uwagi_wew }}</span>
            {% else %}
              <span class="text-muted fst-italic">Brak uwag.</span>
            {% endif %}
        </div>

        <div class="d-flex align-items-center gap-2">
            <strong>Za≈ÇƒÖcznik (skan):</strong>
            {% if chrzest.skan_aktu %}
                <a href="{{ chrzest.skan_aktu.url }}" target="_blank" class="btn btn-outline-primary btn-sm">
                  üìÑ Zobacz skan aktu
                </a>
            {% else %}
                <span class="text-muted small">Brak za≈ÇƒÖczonego pliku.</span>
            {% endif %}
        </div>

      </div>
    </div>
  </div>

  {# --- CZWARTY WIERSZ: Drukowanie --- #}
  <div class="col-12">
    <div class="card shadow-sm border-0 bg-body-tertiary">
      <div class="card-header fw-semibold">
        üñ®Ô∏è Opcje wydruku ≈õwiadectwa
      </div>
      <div class="card-body">
        <div class="row align-items-end g-2">
          <div class="col-md-8">
            <label for="print_purpose" class="form-label small text-muted">
              Wybierz adnotacjƒô, kt√≥ra pojawi siƒô w polu "Cel wydania / Uwagi":
            </label>
            <select id="print_purpose" class="form-select form-select-sm">
              <option value="" selected>(Brak adnotacji - cel og√≥lny)</option>
              <option value="Do ≈õlubu ko≈õcielnego">Do ≈õlubu ko≈õcielnego</option>
              <option value="Do bierzmowania">Do bierzmowania</option>
              <option value="≈öwiƒôcenia kap≈Ça≈Ñskie">≈öwiƒôcenia kap≈Ça≈Ñskie</option>
              <option value="WystƒÖpienie z ko≈õcio≈Ça">WystƒÖpienie z ko≈õcio≈Ça</option>
              <option value="matka_chrzestna">Matka chrzestna (za≈õwiadczenie)</option>
              <option value="ojciec_chrzestny">Ojciec chrzestny (za≈õwiadczenie)</option>
              <option value="uwagi_wew">(Poka≈º uwagi wewnƒôtrzne z ksiƒôgi)</option>
            </select>
          </div>
          <div class="col-md-4">
             <button id="print_button" class="btn btn-primary btn-sm w-100">
                Generuj PDF
             </button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  document.getElementById('print_button').addEventListener('click', function() {
    var cel = document.getElementById('print_purpose').value;
    var baseUrl = "{% url 'chrzest_pdf' chrzest.pk %}";
    var finalUrl = baseUrl;

    if (cel) {
      var separator = finalUrl.includes('?') ? '&' : '?';
      finalUrl += separator + 'cel=' + encodeURIComponent(cel);
    }
    window.open(finalUrl, '_blank');
  });
</script>

{% endblock %}